# 정보

Krum Pashov, 또는 **pashov**는 독립적인 스마트 계약 보안 연구원입니다. 다양한 프로토콜에서 수많은 보안 취약점을 발견했으며, 보안 연구 및 검토에 시간과 노력을 투자하여 블록체인 생태계와 프로토콜에 기여하기 위해 최선을 다하고 있습니다. 그의 이전 작업은 [여기](https://github.com/pashov/audits)에서 확인하거나 Twitter [@pashovkrum](https://twitter.com/pashovkrum)으로 연락하세요.

# 면책 조항

스마트 계약 보안 검토는 취약점의 완전한 부재를 절대 보장할 수 없습니다. 이는 시간, 자원 및 전문 지식에 제한이 있는 노력으로, 가능한 한 많은 취약점을 찾으려고 노력합니다. 검토 후 100% 보안을 보장할 수 없으며, 검토가 귀하의 스마트 계약에서 문제를 발견할 것이라고 보장할 수도 없습니다. 후속 보안 검토, 버그 바운티 프로그램 및 온체인 모니터링을 강력히 권장합니다.

# 소개

**Wrapped Elon**에 대해 시간 제한이 있는 보안 검토를 **pashov**가 수행했으며, 애플리케이션의 스마트 계약 구현의 보안 측면에 중점을 두었습니다.

# Wrapped Elon 소개

이 프로토콜은 Dogelon Mars ERC20 토큰 보유자가 토큰을 래핑(wrap)하여 다른 체인으로의 브리징과 더 잘 작동하는 래핑된 버전의 토큰으로 변환할 수 있도록 합니다. 예를 들어 Solana는 높은 소수점 토큰과 잘 작동하지 않기 때문입니다. 더 작은 소수점으로 래핑된 버전을 브리징하면 통합 문제가 해결됩니다.

# 위험 분류

| 심각도 | 영향: 높음 | 영향: 중간 | 영향: 낮음 |
| --- | --- | --- | --- |
| **가능성: 높음** | 치명적 | 높음 | 중간 |
| **가능성: 중간** | 높음 | 중간 | 낮음 |
| **가능성: 낮음** | 중간 | 낮음 | 낮음 |

## 영향(Impact)

- 높음(High) - 프로토콜 자산의 상당한 물질적 손실로 이어지거나 사용자 그룹에 심각한 해를 끼칩니다.

- 중간(Medium) - 프로토콜 자산의 중간 정도의 물질적 손실로 이어지거나 사용자 그룹에 적당한 해를 끼칩니다.

- 낮음(Low) - 프로토콜 자산의 경미한 물질적 손실로 이어지거나 소규모 사용자 그룹에 해를 끼칩니다.

## 가능성(Likelihood)

- 높음(High) - 온체인 조건을 모방하는 합리적인 가정으로 공격 경로가 가능하며, 도난당하거나 분실될 수 있는 자금의 양에 비해 공격 비용이 비교적 낮습니다.

- 중간(Medium) - 조건부 인센티브가 있는 공격 벡터일 뿐이지만 여전히 발생할 가능성이 비교적 높습니다.

- 낮음(Low) - 너무 많거나 너무 그럴듯하지 않은 가정이 있거나 인센티브가 거의 없거나 전혀 없는 공격자의 상당한 지분을 필요로 합니다.

## 심각도 수준에 따른 조치 필요

- 치명적(Critical) - 가능한 한 빨리 수정해야 함 (이미 배포된 경우)

- 높음(High) - 수정해야 함 (아직 배포되지 않은 경우 배포 전)

- 중간(Medium) - 수정해야 함

- 낮음(Low) - 수정할 수 있음

# 보안 평가 요약

**_검토 커밋 해시_ - [c4fff0af9d6a2eec5258ec870f5314001c48c026](https://github.com/DogelonMars/wrapped-elon/tree/c4fff0af9d6a2eec5258ec870f5314001c48c026)**

**_수정 검토 커밋 해시_ - [a04916b3cbf1719438857701dcace126c67bb9bd](https://github.com/DogelonMars/wrapped-elon/tree/a04916b3cbf1719438857701dcace126c67bb9bd)**

# 결과

# [M-01] `setEnabledState`에 중앙화 공격 벡터가 존재함

## 심각도

**영향:**
높음, 소유자가 래핑된 자산의 언래핑을 차단할 수 있기 때문

**가능성:**
낮음, 악의적이거나 타협된 소유자가 필요하기 때문

## 설명

`WrappedElon`의 `setEnabledState` 메서드는 계약 소유자가 토큰의 래핑 및 언래핑을 비활성화(또는 활성화)할 수 있도록 합니다. 문제는 악의적이거나 타협된 소유자가 사용자에게 나쁜 행동을 하여 토큰 언래핑을 차단하여 본질적으로 자금을 잠글 수 있다는 것입니다. 소유권이 소각되거나(또는 개인 키가 분실된 경우) 되돌릴 수 없게 됩니다.

## 권장 사항

여기서 잠재적인 완화 조치는 거버넌스 또는 다중 서명을 계약 소유자로 사용하는 것입니다. 더 좋은 방법은 사용자가 조치를 취할 수 있도록 래핑/언래핑을 활성화/비활성화하기 전에 알림을 받을 수 있는 Timelock 계약을 사용하는 것입니다. 하지만 이는 브리지 공격에 대한 위험 완화로 메서드를 사용하는 이점을 제거합니다.

# [L-01] 언래핑을 비활성화하면 모든 브리지가 동시에 차단됨

`wrapEnabled` 및 `unwrapEnabled` 변수는 결함이 있는 브리지(잠재적으로 무한 발행 취약점이 있는 브리지)에 대한 완화 메커니즘으로 추가되었습니다. 문제는 이 래핑된 토큰이 여러 브리지에 사용되거나 통합된 경우 `unwrapEnabled`를 `false`로 설정하면 그중 하나만 결함이 있더라도 모든 브리지가 동시에 차단된다는 것입니다. 내결함성이 있는 방식으로 여러 브리지 통합을 처리할 수 있는 메커니즘으로 전환하는 것을 고려하십시오.

# [L-02] 래핑된 토큰 이름이 언래핑된 토큰 이름임

`WrappedElon` 계약은 `$ELON` 토큰의 래퍼 역할을 합니다. 생성자의 모습은 다음과 같습니다:

```solidity
constructor() ERC20("Dogelon", "ELON") {}
```

문제는 "Wrapped" 단어가 앞에 붙은 동일한 이름으로 토큰 이름을 지정하는 대신 언래핑된 버전과 동일한 이름을 사용한다는 것입니다. 이는 특히 어떤 이유로 래핑된 토큰으로 유동성 풀이 생성되는 경우 혼란을 야기할 수 있습니다. 생성자를 다음과 같이 변경하십시오:

```diff
-constructor() ERC20("Dogelon", "ELON") {}
+constructor() ERC20("WrappedDogelon", "WELON") {}
```

# [L-03] 프로토콜이 취약한 라이브러리 버전을 사용 중임

리포지토리의 `package.json` 파일에서 다음을 볼 수 있습니다:

```javascript
"@openzeppelin/contracts": "^4.7.3",
```

이 버전에는 [여기](https://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories)에서 볼 수 있듯이 여러 취약점이 포함되어 있습니다. 현재 코드베이스에는 문제가 없지만 v4.7.3 이후 발견된 모든 취약점에 대한 수정 사항이 있는 v4.9.5로 버전을 업그레이드하는 것이 강력히 권장됩니다.

