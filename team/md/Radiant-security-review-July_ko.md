# 정보

Pashov Audit Group은 업계 최고의 스마트 계약 보안 연구원들로 구성된 여러 팀으로 이루어져 있습니다. 1000개 이상의 보안 취약점을 보고한 경험을 바탕으로, 그룹은 절대적으로 최고의 감사 여정을 제공하기 위해 노력합니다. 100% 보안은 보장할 수 없지만, 숙련된 연구원들이 귀하의 블록체인 프로토콜을 위해 최선을 다할 것임을 보장합니다. [여기](https://github.com/pashov/audits)에서 이전 작업을 확인하거나 Twitter [@pashovkrum](https://twitter.com/pashovkrum)으로 연락하십시오.

# 면책 조항

스마트 계약 보안 검토는 취약점의 완전한 부재를 절대 확인할 수 없습니다. 이는 시간, 자원 및 전문 지식이 제한된 노력으로, 우리는 가능한 한 많은 취약점을 찾기 위해 노력합니다. 우리는 검토 후 100% 보안을 보장할 수 없으며, 검토가 스마트 계약의 문제를 발견할 것이라고 보장할 수도 없습니다. 후속 보안 검토, 버그 바운티 프로그램 및 온체인 모니터링을 강력히 권장합니다.

# 소개

**radiant-capital/v2-core** 저장소에 대한 시간 제한 보안 검토는 **Pashov Audit Group**에 의해 수행되었으며, 애플리케이션의 스마트 계약 구현의 보안 측면에 중점을 두었습니다.

# Radiant 정보

UniV3TokenizedLp는 Uniswap V3와 유사한 풀에서 토큰화된 유동성 포지션을 관리합니다. 이를 통해 사용자는 유동성 풀의 지분을 나타내는 ERC20 토큰을 대가로 예치할 수 있습니다. 이 계약에는 유동성 포지션을 재조정하고 가격 조작을 방지하기 위해 외부 오라클 가격 피드의 정확성을 보장하는 메커니즘이 포함되어 있습니다.

# 위험 분류

| 심각도 | 영향: 높음 | 영향: 중간 | 영향: 낮음 |
| --- | --- | --- | --- |
| **가능성: 높음** | 치명적 | 높음 | 중간 |
| **가능성: 중간** | 높음 | 중간 | 낮음 |
| **가능성: 낮음** | 중간 | 낮음 | 낮음 |

## 영향

- 높음 - 프로토콜의 자산에 상당한 물질적 손실을 초래하거나 사용자 그룹에 상당한 피해를 줍니다.

- 중간 - 프로토콜의 자산에 중간 정도의 물질적 손실을 초래하거나 사용자 그룹에 중간 정도의 피해를 줍니다.

- 낮음 - 프로토콜의 자산에 경미한 물질적 손실을 초래하거나 소수의 사용자 그룹에 피해를 줍니다.

## 가능성

- 높음 - 온체인 조건을 모방한 합리적인 가정 하에 공격 경로가 가능하며, 도난당하거나 손실될 수 있는 자금의 양에 비해 공격 비용이 상대적으로 낮습니다.

- 중간 - 조건부로 인센티브가 주어지는 공격 벡터이지만 여전히 상대적으로 가능성이 높습니다.

- 낮음 - 가정이 너무 많거나 희박하거나, 인센티브가 거의 또는 전혀 없이 공격자가 상당한 지분을 투자해야 합니다.

## 심각도 수준에 따른 조치

- 치명적 - 가능한 한 빨리 수정해야 함 (이미 배포된 경우)

- 높음 - 수정해야 함 (아직 배포되지 않은 경우 배포 전)

- 중간 - 수정하는 것이 좋음

- 낮음 - 수정할 수 있음

# 보안 평가 요약

_검토 커밋 해시_ - [bb1680bea467e1032d0431ddc66ccc96cbd8fa33](https://github.com/radiant-capital/v2-core/tree/bb1680bea467e1032d0431ddc66ccc96cbd8fa33)

_수정 검토 커밋 해시_ - [2c30b8f76493ae9b6da993e384e5edf21b5d25e6](https://github.com/radiant-capital/v2-core/tree/2c30b8f76493ae9b6da993e384e5edf21b5d25e6)

### 범위

다음 스마트 계약이 감사 범위에 포함되었습니다.

- `UniV3PoolHelper`
- `UniV3TokenizedLP`

# 발견 사항

# [H-01] `spotTimeWeightedPrice`와 `withSwapping`이 충돌할 수 있음

## 심각도

**영향:** 높음

**가능성:** 중간

## 설명

`autoRebalance` 함수에는 두 개의 입력 매개변수가 있습니다.

- `useOracleForNewBounds`: `false`인 경우 `spotTimeWeightedPrice`를 사용하여 새로운 `baseLower` 및 `baseUpper`를 결정합니다.
- `withSwapping`: `true`인 경우 현물 가격과 오라클 가격의 차이가 너무 크면 일부 토큰을 스왑하여 현물 가격을 오라클 가격에 가깝게 만듭니다.

다음 시나리오는 `useOracleForNewBounds`가 `false`이고 `withSwapping`이 `true`이며 현물 가격과 오라클 가격의 차이가 너무 클 때 발생합니다. 스왑 후의 현물 가격과 스왑 전에 얻은 `spotTimeWeightedPrice` 사이에 불일치가 있습니다. `baseLower`와 `baseUpper`는 스왑 전 가격에 의해 결정됩니다. 이는 불합리한 최종 유동성 범위로 이어집니다.

극단적인 경우, 이는 불합리한 유동성 범위 사용으로 인해 민트 실패 또는 보상받지 못한 손실을 초래할 수 있습니다.

## 권장 사항

스왑 제한 가격이 `priceRefForBounds`와 동일한지 확인하십시오.

# [M-01] `deposit`이 유동성을 민팅하지 않을 수 있음

## 심각도

**영향:** 중간

**가능성:** 중간

## 설명

`deposit` 함수는 범위(bounds)가 정의된 경우에만 유동성을 민팅합니다. 그러나 범위가 정의되었는지 확인하는 방법이 잘못되었습니다.

`baseLower`와 `baseUpper`가 모두 `0`이면 범위는 정의되지 않은 것입니다. 그러나 `deposit` 함수는 `baseLower`와 `baseUpper` 중 하나만 `0`이어도 유동성을 민팅하지 않습니다. uniswap pool v3의 경우 가격이 `1`이면 틱은 `0`입니다. 따라서 이로 인해 범위가 이미 정의되어 있음에도 `deposit` 함수가 유동성을 민팅하지 않는 결과가 발생합니다.

## 권장 사항

`baseLower`와 `baseUpper` 중 하나가 `0`이 아니면 유동성을 민팅하십시오.

# [M-02] `swapIdleAndAddToLiquidity`가 DoS될 수 있음

## 심각도

**영향:** 중간

**가능성:** 중간

## 설명

`swapIdleAndAddToLiquidity` 함수는 리밸런서가 `swapQuantity`를 입력하여 특정 양의 토큰을 스왑할 수 있도록 합니다. 리밸런서가 잔액을 `swapQuantity`로 사용하여 모든 토큰을 스왑하려고 한다고 가정해 보겠습니다. 사용자가 미리 일부 토큰을 인출하면 계약 잔액이 `swapQuantity`보다 적어져 스왑이 실패하게 됩니다.

## 권장 사항

스왑 입력으로 `swapQuantity`와 잔액 중 더 작은 값을 취하십시오.

# [M-03] `zapWETH`에 가격 제한 없음

## 심각도

**영향:** 중간

**가능성:** 중간

## 설명

`zapWETH` 함수는 일부 WETH를 `UniV3TokenizedLp`에 예치합니다. `UniV3TokenizedLp`에 WETH가 너무 많으면 일부 WETH는 가격 제한 없이 스왑됩니다. 또한 호출자인 `LockZap` 계약은 슬리피지를 확인하지 않습니다. `LockZap`은 예치에서 받은 LP 수만 확인합니다. 그러나 이 문제는 더 적은 수량보다는 더 작은 LP 가치를 초래합니다.

## 권장 사항

슬리피지 확인을 추가하십시오.
