# 소개

Pashov Audit Group은 업계 최고의 스마트 계약 보안 연구원들로 구성된 여러 팀으로 이루어져 있습니다. 총 1000개 이상의 보안 취약점을 보고한 이 그룹은 절대적으로 최고의 감사 경험을 제공하기 위해 노력합니다. 100%의 보안을 보장할 수는 없지만, 숙련된 연구원들이 귀하의 블록체인 프로토콜을 위해 최선의 노력을 다할 것을 보장합니다. 이전 작업은 [여기](https://github.com/pashov/audits)에서 확인하거나 Twitter [@pashovkrum](https://twitter.com/pashovkrum)으로 문의하십시오.

# 면책 조항

스마트 계약 보안 검토는 취약점의 완전한 부재를 절대 확인할 수 없습니다. 이는 시간, 자원 및 전문 지식이 제한된 노력으로, 가능한 한 많은 취약점을 찾기 위해 시도합니다. 검토 후 100% 보안을 보장할 수 없으며, 검토를 통해 스마트 계약에서 문제를 발견할 것이라고 보장할 수도 없습니다. 후속 보안 검토, 버그 바운티 프로그램 및 온체인 모니터링을 강력히 권장합니다.

# 소개

**bob-collective/bob-ordinals-bridge** 저장소에 대한 시간 제한 보안 검토가 **Pashov Audit Group**에 의해 수행되었으며, 애플리케이션의 스마트 계약 구현의 보안 측면에 중점을 두었습니다.

# BOB Ordinals Bridge 소개

BOB은 비트코인과 이더리움을 기반으로 하는 하이브리드 레이어-2입니다. 이 디자인은 비트코인 사용자가 이더리움 자산을 미리 보유하지 않고도 BOB L2에 쉽게 온보딩할 수 있도록 합니다. BOB은 오디널스(Ordinals)를 구현합니다. 오디널스는 비트코인의 가장 작은 단위인 사토시를 추적하고 전송하며 사토시에 데이터를 첨부하는 시스템입니다. 사토시에 데이터가 첨부되면 인스크립션(inscription)이 생성됩니다. 인스크립션 콘텐츠는 완전히 온체인에 있으며, 탭루트(taproot) 스크립트 경로 지출 스크립트에 영구적으로 저장됩니다.

# 위험 분류

| 심각도 | 영향: 높음 | 영향: 중간 | 영향: 낮음 |
| --- | --- | --- | --- |
| **가능성: 높음** | 치명적 | 높음 | 중간 |
| **가능성: 중간** | 높음 | 중간 | 낮음 |
| **가능성: 낮음** | 중간 | 낮음 | 낮음 |

## 영향

- 높음 - 프로토콜의 자산에 심각한 물적 손실을 초래하거나 사용자 그룹에 심각한 해를 끼칩니다.
- 중간 - 프로토콜의 자산에 중간 정도의 물적 손실을 초래하거나 사용자 그룹에 적당한 해를 끼칩니다.
- 낮음 - 프로토콜의 자산에 경미한 물적 손실을 초래하거나 소규모 사용자 그룹에 해를 끼칩니다.

## 가능성

- 높음 - 공격 경로가 온체인 조건을 모방하는 합리적인 가정 하에 가능하며, 도난당하거나 손실될 수 있는 자금의 양에 비해 공격 비용이 상대적으로 낮습니다.
- 중간 - 조건부로 인센티브가 주어지는 공격 벡터이지만 여전히 상대적으로 가능성이 있습니다.
- 낮음 - 가정이 너무 많거나 희박하거나, 공격자가 인센티브가 거의 없거나 전혀 없는 상태에서 상당한 지분을 필요로 합니다.

## 심각도 수준에 따른 조치 필요

- 치명적 - 가능한 한 빨리 수정해야 함 (이미 배포된 경우)
- 높음 - 수정해야 함 (배포 전, 이미 배포되지 않은 경우)
- 중간 - 수정해야 함
- 낮음 - 수정할 수 있음

# 보안 평가 요약

_검토 커밋 해시_ - [96762a2866edf1f1371bacc527d1a56031b872e2](https://github.com/bob-collective/bob-ordinals-bridge/commit/96762a2866edf1f1371bacc527d1a56031b872e2)

_수정 검토 커밋 해시_ - [70c9cf645b432ad9d5e40a6de5b0970b89b4ae26](https://github.com/bob-collective/bob-ordinals-bridge/commit/70c9cf645b432ad9d5e40a6de5b0970b89b4ae26)

### 범위

다음 스마트 계약들이 감사 범위에 포함되었습니다:

- `OrdinalsNFT`
- `Bridge`
- `MultiSig`
- `SigCollection`

# 발견 사항

# [M-01] 가스 가격 변동으로 인해 `sigFees` 계산이 불충분할 수 있음

## 심각도

**영향:** 중간

**가능성:** 중간

## 설명

사용자가 상환(redemption)을 요청하면 검증자들은 서명을 제출하여 결국 비트코인 오디널스를 전송합니다. 검증자의 가스비를 보상하기 위해 사용자는 이에 대한 비용을 지불해야 합니다.

```solidity
uint256 sigFees = BTC_SIG_GAS_USAGE * tx.gasprice * uint256(multisig.activeCommitteeSize);
```

이 `sigFees`는 검증자들이 멀티시그(multisig) 서명을 게시할 때 발생하는 가스 비용을 충당하기 위한 것입니다. 문제는 이 함수가 `tx.gasPrice`를 사용한다는 점입니다. 이는 사용자가 제어하는 인수이며 네트워크 트래픽에 크게 의존합니다.

앨리스가 오디널스를 상환하고 싶다고 가정해 봅시다. 그녀는 네트워크 트래픽이 낮은 시간에 `redeem`을 호출하므로 `tx.gasPrice`를 0.1 gwei로 설정합니다. 검증자들이 서명을 제출해야 할 때, 네트워크 트래픽 증가로 인해 가스 가격이 급등했을 수 있습니다. 검증자들은 트랜잭션을 통과시키기 위해 0.2 gwei와 같이 더 높은 가스 가격을 사용해야 합니다.

0.1 gwei 가격의 가스비만 책정되었으므로 검증자는 트랜잭션을 수행하는 것을 거부할 것입니다.

이는 앨리스의 잘못이 아닙니다. 그녀는 아마도 현재 블록에 적합한 가스 가격을 추측하는 지갑으로 트랜잭션을 수행했을 것이기 때문입니다. 앨리스가 상환이 확실히 이루어지도록 하려면 미래의 더 높은 네트워크 사용량을 예상하여 수동으로 `tx.gasPrice`를 더 높게 설정해야 합니다. 그러나 이는 현재 트랜잭션에 필요하지 않은 훨씬 더 높은 가스 가격으로 입찰하게 되므로 가스를 낭비하게 됩니다.

또한, 가스 가격을 0으로 설정하여 수수료 지불을 피할 수도 있습니다.

# 권장 사항

앨리스가 검증자들에게 가스비로 할당할 ETH 양을 지정하고, 상환이 끝난 후 나머지를 그녀에게 환불하도록 허용하는 것을 고려하십시오.

# [L-01] multisigHash는 만료 기한이 있어야 함

현재 `multisigHash` 문에는 만료일이 없습니다. 이는 `threshold` 변수를 낮추거나 특정 시점에 일부 검증자가 악의적으로 변하여 이전에 악의적인 `multisigHash`가 갑자기 승인될 수 있는 위험을 초래합니다.

# [L-02] 상환/민팅 수수료를 위한 `msg.value`의 최대 금액 설정

`msg.value`는 `redeemFees`와 `mintFees`를 충전하기 위해 허용될 수 있습니다.
그러나 이는 필요한 금액보다 훨씬 높더라도 어떤 숫자든 될 수 있습니다.
합리적인 최대 허용 필요 금액과 비교하는 것을 고려하십시오.

# [L-03] 하드코딩된 `BTC_SIG_GAS_USAGE`는 네트워크 업그레이드 시 브릿지를 작동 불능 상태로 만들 수 있음

`Bridge.sol` 계약의 `_remFees` 함수는 검증자의 가스비를 공제합니다. 이는 비트코인 서명 제출 비용을 고정된 비용으로 가정하고 계산합니다.

```solidity
uint256 private constant BTC_SIG_GAS_USAGE = 33704;
uint256 sigFees = BTC_SIG_GAS_USAGE * tx.gasprice * uint256(multisig.activeCommitteeSize);
```

그러나 네트워크 업그레이드로 인해 저장, 읽기 등과 같은 다양한 작업에 대한 가스비가 변경될 수 있습니다. 비트코인 서명 제출 비용이 변경되면 `BTC_SIG_GAS_USAGE`가 상수로 정의되어 변경할 수 없으므로 계산된 `sigFees`가 틀리게 됩니다. 이 경우 브릿지를 재배포해야 합니다.

`BTC_SIG_GAS_USAGE`를 변경 가능하도록 허용하는 것을 고려하십시오.

